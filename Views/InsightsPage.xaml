<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:HereForYou.ViewModels"
             xmlns:models="clr-namespace:HereForYou.Models"
             x:Class="HereForYou.Views.InsightsPage"
             x:DataType="vm:InsightsViewModel"
             Title="×ª×•×‘× ×•×ª"
             FlowDirection="RightToLeft">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="20">

            <!-- ×›×•×ª×¨×ª -->
            <Label Text="ðŸ“Š ×ª×•×‘× ×•×ª ×•×¡×˜×˜×™×¡×˜×™×§×•×ª" FontSize="28" FontAttributes="Bold" />

            <!-- ×›×¤×ª×•×¨ ×¨×¢× ×•×Ÿ -->
            <Button Text="ðŸ”„ ×¨×¢× ×Ÿ"
                    Command="{Binding RefreshCommand}"
                    HorizontalOptions="End"
                    WidthRequest="100" />

            <!-- ×¡×˜×˜×™×¡×˜×™×§×•×ª ×”×™×•× -->
            <Frame BackgroundColor="{StaticResource Primary}" CornerRadius="10" Padding="15">
                <VerticalStackLayout Spacing="10">
                    <Label Text="ðŸ“… ×”×™×•×" FontSize="20" FontAttributes="Bold" TextColor="White" />

                    <Grid ColumnDefinitions="*,*,*" ColumnSpacing="10">
                        <VerticalStackLayout Grid.Column="0">
                            <Label Text="â±ï¸" FontSize="24" HorizontalOptions="Center" TextColor="White" />
                            <Label Text="{Binding TodayScreenTime}" FontSize="18" FontAttributes="Bold"
                                   HorizontalOptions="Center" TextColor="White" />
                            <Label Text="×–×ž×Ÿ ×ž×¡×š" FontSize="12" HorizontalOptions="Center" TextColor="White" />
                        </VerticalStackLayout>

                        <VerticalStackLayout Grid.Column="1">
                            <Label Text="ðŸ‘‚" FontSize="24" HorizontalOptions="Center" TextColor="White" />
                            <Label Text="{Binding TodayDetections}" FontSize="18" FontAttributes="Bold"
                                   HorizontalOptions="Center" TextColor="White" />
                            <Label Text="×–×™×”×•×™×™×" FontSize="12" HorizontalOptions="Center" TextColor="White" />
                        </VerticalStackLayout>

                        <VerticalStackLayout Grid.Column="2">
                            <Label Text="ðŸ””" FontSize="24" HorizontalOptions="Center" TextColor="White" />
                            <Label Text="{Binding TodayAlerts}" FontSize="18" FontAttributes="Bold"
                                   HorizontalOptions="Center" TextColor="White" />
                            <Label Text="×”×ª×¨××•×ª" FontSize="12" HorizontalOptions="Center" TextColor="White" />
                        </VerticalStackLayout>
                    </Grid>
                </VerticalStackLayout>
            </Frame>

            <!-- ×¡×˜×˜×™×¡×˜×™×§×•×ª ×©×‘×•×¢ -->
            <Frame BackgroundColor="#F5F5F5" CornerRadius="10" Padding="15">
                <VerticalStackLayout Spacing="10">
                    <Label Text="ðŸ“ˆ ×©×‘×•×¢ ××—×¨×•×Ÿ" FontSize="20" FontAttributes="Bold" />

                    <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto" ColumnSpacing="15" RowSpacing="15">

                        <VerticalStackLayout Grid.Row="0" Grid.Column="0">
                            <Label Text="â±ï¸" FontSize="20" HorizontalOptions="Center" />
                            <Label Text="{Binding WeekScreenTime}" FontSize="16" FontAttributes="Bold"
                                   HorizontalOptions="Center" />
                            <Label Text="×¡×”×´×› ×–×ž×Ÿ ×ž×¡×š" FontSize="11" HorizontalOptions="Center" />
                        </VerticalStackLayout>

                        <VerticalStackLayout Grid.Row="0" Grid.Column="1">
                            <Label Text="ðŸ‘‚" FontSize="20" HorizontalOptions="Center" />
                            <Label Text="{Binding WeekDetections}" FontSize="16" FontAttributes="Bold"
                                   HorizontalOptions="Center" />
                            <Label Text="×¡×”×´×› ×–×™×”×•×™×™×" FontSize="11" HorizontalOptions="Center" />
                        </VerticalStackLayout>

                        <VerticalStackLayout Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2">
                            <Label Text="âœ…" FontSize="20" HorizontalOptions="Center" />
                            <Label Text="{Binding ResponseRate, StringFormat='{0:F1}%'}" FontSize="16" FontAttributes="Bold"
                                   HorizontalOptions="Center" />
                            <Label Text="××—×•×– ×ž×¢× ×”" FontSize="11" HorizontalOptions="Center" />
                        </VerticalStackLayout>

                    </Grid>
                </VerticalStackLayout>
            </Frame>

            <!-- ×¡×™×›×•×ž×™× ×™×•×ž×™×™× -->
            <VerticalStackLayout Spacing="10">
                <Label Text="ðŸ“‹ ×¡×™×›×•×ž×™× ×™×•×ž×™×™×" FontSize="18" FontAttributes="Bold" />

                <CollectionView ItemsSource="{Binding RecentSummaries}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="models:DailySummary">
                            <Frame Margin="0,5" Padding="10" CornerRadius="8" BackgroundColor="#F9F9F9">
                                <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="10">
                                    <Label Grid.Column="0" Text="{Binding Date, StringFormat='{0:dd/MM}'}"
                                           FontSize="14" FontAttributes="Bold" VerticalOptions="Center" />

                                    <VerticalStackLayout Grid.Column="1">
                                        <Label Text="{Binding TotalScreenTime, StringFormat='â±ï¸ {0:hh\\:mm}'}"
                                               FontSize="12" />
                                        <Label Text="{Binding TotalDetections, StringFormat='ðŸ‘‚ {0} ×–×™×”×•×™×™×'}"
                                               FontSize="12" />
                                    </VerticalStackLayout>

                                    <Label Grid.Column="2"
                                           Text="{Binding ResponseRate, StringFormat='âœ… {0:F0}%'}"
                                           FontSize="12" VerticalOptions="Center" />
                                </Grid>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </VerticalStackLayout>

            <!-- ×–×™×”×•×™×™× ××—×¨×•× ×™× -->
            <VerticalStackLayout Spacing="10">
                <Label Text="ðŸ• ×–×™×”×•×™×™× ××—×¨×•× ×™×" FontSize="18" FontAttributes="Bold" />

                <CollectionView ItemsSource="{Binding RecentDetections}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="models:DetectionEvent">
                            <Frame Margin="0,3" Padding="8" CornerRadius="6" BackgroundColor="#FAFAFA">
                                <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="10">
                                    <Label Grid.Column="0"
                                           Text="{Binding Timestamp, StringFormat='{0:HH:mm}'}"
                                           FontSize="12" VerticalOptions="Center" />

                                    <Label Grid.Column="1"
                                           Text="{Binding Keyword}"
                                           FontSize="12" FontAttributes="Bold" VerticalOptions="Center" />

                                    <Label Grid.Column="2"
                                           Text="{Binding WasRespondedTo, Converter={StaticResource BoolToTextConverter}}"
                                           FontSize="11" VerticalOptions="Center"
                                           TextColor="{StaticResource Primary}" />
                                </Grid>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </VerticalStackLayout>

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>
